/**
 * Created by saman on 5/31/17.
 * recoverController.js
 contactController.js
 enterpriseController.js
 faqController.js
 helpController.js
 jobController.js
 privacyController.js
 termsController.js
 whitepaperController.js
 profileController.js
 transactionListController.js
 transactionCreateController.js
 transactionSummaryController.js
 transactionDetailController.js
 authController.js
 forgetPasswordController.js
 errorToastController.js
 */
angular.module("myApp").controller("RecoverController",["$scope","$filter","UtilsFactory","StorageFactory","$translate","$location","$routeParams",function(t,e,a,o,n,r,s){t.recoverEmail=s.email,t.recoverHash=s.hash,t.recoverConfirmPassword="",t.recoverPassword="",this.submit=function(){var e=a.SHA256(t.recoverPassword);a.HttpPost("/changePass",{h:t.recoverHash,passwordHash:e}).then(function(e){t.loading=!1,200===e.status&&r.path("/")}).catch(function(e){a.Toast({text:n.instant("recover.changeException"),type:"error"}),t.loading=!1})}}]),angular.module("myApp").controller("ContactController",["$scope",function(t){t.title="تماس با ما",t.text="لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ و با استفاده از طراحان گرافیک است. چاپگرها و متون بلکه روزنامه و مجله در ستون و سطرآنچنان که لازم است و برای شرایط فعلی تکنولوژی مورد نیاز و کاربردهای متنوع با هدف بهبود ابزارهای کاربردی می باشد. کتابهای زیادی در شصت و سه درصد گذشته، حال و آینده شناخت فراوان جامعه و متخصصان را می طلبد تا با نرم افزارها شناخت بیشتری را برای طراحان رایانه ای علی الخصوص طراحان خلاقی و فرهنگ پیشرو در زبان فارسی ایجاد کرد. در این صورت می توان امید داشت که تمام و دشواری موجود در ارائه راهکارها و شرایط سخت تایپ به پایان رسد وزمان مورد نیاز شامل حروفچینی دستاوردهای اصلی و جوابگوی سوالات پیوسته اهل دنیای موجود طراحی اساسا مورد استفاده قرار گیرد."}]),angular.module("myApp").controller("EnterpriseController",["$scope",function(t){t.title="Enterprise Solutions",t.text="لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ و با استفاده از طراحان گرافیک است. چاپگرها و متون بلکه روزنامه و مجله در ستون و سطرآنچنان که لازم است و برای شرایط فعلی تکنولوژی مورد نیاز و کاربردهای متنوع با هدف بهبود ابزارهای کاربردی می باشد. کتابهای زیادی در شصت و سه درصد گذشته، حال و آینده شناخت فراوان جامعه و متخصصان را می طلبد تا با نرم افزارها شناخت بیشتری را برای طراحان رایانه ای علی الخصوص طراحان خلاقی و فرهنگ پیشرو در زبان فارسی ایجاد کرد. در این صورت می توان امید داشت که تمام و دشواری موجود در ارائه راهکارها و شرایط سخت تایپ به پایان رسد وزمان مورد نیاز شامل حروفچینی دستاوردهای اصلی و جوابگوی سوالات پیوسته اهل دنیای موجود طراحی اساسا مورد استفاده قرار گیرد."}]),angular.module("myApp").controller("FaqController",["$scope",function(t){t.title="سوالات متداول",t.text="لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ و با استفاده از طراحان گرافیک است. چاپگرها و متون بلکه روزنامه و مجله در ستون و سطرآنچنان که لازم است و برای شرایط فعلی تکنولوژی مورد نیاز و کاربردهای متنوع با هدف بهبود ابزارهای کاربردی می باشد. کتابهای زیادی در شصت و سه درصد گذشته، حال و آینده شناخت فراوان جامعه و متخصصان را می طلبد تا با نرم افزارها شناخت بیشتری را برای طراحان رایانه ای علی الخصوص طراحان خلاقی و فرهنگ پیشرو در زبان فارسی ایجاد کرد. در این صورت می توان امید داشت که تمام و دشواری موجود در ارائه راهکارها و شرایط سخت تایپ به پایان رسد وزمان مورد نیاز شامل حروفچینی دستاوردهای اصلی و جوابگوی سوالات پیوسته اهل دنیای موجود طراحی اساسا مورد استفاده قرار گیرد.",t.data=["Item 1","Item 2","Item 3","Item 4"],t.toggle={}}]),angular.module("myApp").controller("HelpController",["$scope",function(t){t.title="راهنما",t.text="لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ و با استفاده از طراحان گرافیک است. چاپگرها و متون بلکه روزنامه و مجله در ستون و سطرآنچنان که لازم است و برای شرایط فعلی تکنولوژی مورد نیاز و کاربردهای متنوع با هدف بهبود ابزارهای کاربردی می باشد. کتابهای زیادی در شصت و سه درصد گذشته، حال و آینده شناخت فراوان جامعه و متخصصان را می طلبد تا با نرم افزارها شناخت بیشتری را برای طراحان رایانه ای علی الخصوص طراحان خلاقی و فرهنگ پیشرو در زبان فارسی ایجاد کرد. در این صورت می توان امید داشت که تمام و دشواری موجود در ارائه راهکارها و شرایط سخت تایپ به پایان رسد وزمان مورد نیاز شامل حروفچینی دستاوردهای اصلی و جوابگوی سوالات پیوسته اهل دنیای موجود طراحی اساسا مورد استفاده قرار گیرد."}]),angular.module("myApp").controller("JobController",["$scope",function(t){t.title="فرصت‌های شغلی"}]),angular.module("myApp").controller("PrivacyController",["$scope",function(t){t.title="حریم خصوصی"}]),angular.module("myApp").controller("TermsController",["$scope",function(t){t.title="شرایط و ضوابط"}]),angular.module("myApp").controller("WhitePaperController",["$scope",function(t){t.title="White Paper",t.text="لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ و با استفاده از طراحان گرافیک است. چاپگرها و متون بلکه روزنامه و مجله در ستون و سطرآنچنان که لازم است و برای شرایط فعلی تکنولوژی مورد نیاز و کاربردهای متنوع با هدف بهبود ابزارهای کاربردی می باشد. کتابهای زیادی در شصت و سه درصد گذشته، حال و آینده شناخت فراوان جامعه و متخصصان را می طلبد تا با نرم افزارها شناخت بیشتری را برای طراحان رایانه ای علی الخصوص طراحان خلاقی و فرهنگ پیشرو در زبان فارسی ایجاد کرد. در این صورت می توان امید داشت که تمام و دشواری موجود در ارائه راهکارها و شرایط سخت تایپ به پایان رسد وزمان مورد نیاز شامل حروفچینی دستاوردهای اصلی و جوابگوی سوالات پیوسته اهل دنیای موجود طراحی اساسا مورد استفاده قرار گیرد."}]),angular.module("myApp").controller("ProfileController",["$scope","$rootScope","$mdDialog","UtilsFactory","StorageFactory","Upload","$translate",function(t,e,a,o,n,r,s){t.msg={},t.loading=!1,t.userData={fname:n.get("fname"),lname:n.get("lname"),password:"",oldPassword:"",changePassword:!1,pic:""},t.$on("uploadSuccess",function(e){t.userData.pic=e}),t.uploadBtn=function(){document.getElementById("fileInput").click()},t.upload=function(){var e=t.pic;r.upload({url:"upload/url",data:{file:e,username:t.username}}).then(function(t){console.log("Success "+t.config.data.file.name+"uploaded. Response: "+t.data)},function(t){console.log("Error status: "+t.status)},function(t){var e=parseInt(100*t.loaded/t.total);console.log("progress: "+e+"% "+t.config.data.file.name)})},t.submit=function(){t.msg={},t.loading=!0;var r,i;if(t.userData.changePassword&&t.userData.password===t.userData.confirmPassword)r=o.SHA256(t.userData.password),i=o.SHA256(t.userData.oldPassword);else{if(t.userData.changePassword&&t.userData.password!==t.userData.confirmPassword)return t.msg.status=412,t.msg.type="error",void o.Toast({text:s.instant("profile."+t.msg.status),type:"error"});r=n.get("passHash"),i=""}t.pic?t.pic.name:n.get("pic");var c={token:n.get("token"),passwordHash:r,oldPasswordHash:i,name:t.userData.fname,lastName:t.userData.lname,profilePic:t.pic};o.HttpPostWithFile("/updateProfile",c).then(function(i){t.loading=!1,200===i.status&&(t.msg.type="ok",n.set("passHash",r),n.set("fname",t.userData.fname),n.set("lname",t.userData.lname),n.set("pic",t.pic),a.hide("cancel"),e.$broadcast("profileUpdated",!0)),o.Toast({text:s.instant("profile."+i.status),type:t.msg.type})}).catch(function(e){t.loading=!1,o.Toast({text:s.instant("profile."+e.status),type:"error"})})},t.cancel=function(){a.hide("cancel")},t.success=function(){}}]),myApp.directive("chooseFile",function(){return{link:function(t,e,a){var o=e.find("button"),n=angular.element(e[0].querySelector("input#fileInput"));o.bind("click",function(){n[0].click()}),n.bind("change",function(e){t.$apply(function(){var a=e.target.files;a[0]?(t.fileName=a[0].name,t.$emit("uploadSuccess",scope.fileName)):t.fileName=null})})}}}),myApp.controller("TransactionListController",["$scope","UtilsFactory","StorageFactory","_","$translate",function(t,e,a,o,n){function r(t){for(var e="",a=new Uint8Array(t),o=a.byteLength,n=0;n<o;n++)e+=String.fromCharCode(a[n]);return window.btoa(e)}t.getTransactions=function(){return e.HttpPost("/listUserTransactions",{token:a.get("token")}).then(function(e){t.transactions=[];var a={};o.forEach(e.data,function(e,o){a={txId:o,created:moment.unix(e.txCreatedDate/1e3).format("HH:mm - jYYYY/jMM/jDD"),confirmations:e.confirmations,fileId:e.fileId,desc:e.desc},t.userId===e.userId&&(a.isCreator=!0),t.transactions.push(a)})}).catch(function(t){console.error(t),e.Toast({text:n.instant("general.error."+t.status),type:"error"})})},t.downloadFile=function(t){var o=a.get("token");return e.HttpGet("/downloadTnxFile/"+o+"&"+t,{}).then(function(t){var e;return t.data&&(e=r(t.data)),e}).catch(function(t){console.error(t)})},t.search=function(){if(o.isEmpty(t.keywords))return t.getTransactions();if(t.keywords.fromDate&&(t.keywords.fromTimestamp=t.keywords.fromDateFull.unix),t.keywords.toDate&&(t.keywords.toTimestamp=t.keywords.toDateFull.unix),t.keywords.fromDate&&t.keywords.toDate&&t.keywords.fromTimestamp>t.keywords.toTimestamp)return e.Toast({text:n.instant("transaction.list.400"),type:t.msg.type});var r={token:a.get("token"),txId:void 0==t.keywords.txId?"":t.keywords.txId,desc:void 0==t.keywords.desc?"":t.keywords.desc};t.keywords.fromTimestamp&&(r.fromDate=t.keywords.fromTimestamp),t.keywords.toTimestamp&&(r.toDate=t.keywords.toTimestamp),e.HttpPost("/searchTransaction",r).then(function(e){var a={};t.transactions=[],o.forEach(e.data,function(e,o){a={txId:e.txId,created:moment.unix(e.txCreatedDate/1e3).format("HH:mm - jYYYY/jMM/jDD"),confirmations:e.confirmations,fileId:e.fileId,desc:e.desc},t.userId===e.userId&&(a.isCreator=!0),t.transactions.push(a)})}).catch(function(t){console.error(t)})},function(){t.keywords={},t.selected=[],t.token=a.get("token"),t.userId=a.get("userId"),t.query={order:"date",limit:3,page:1},t.transactions=[],t.getTransactions()}()}]),angular.module("myApp").controller("TransactionCreateController",["$scope","$rootScope","data","$mdToast","$mdDialog","UtilsFactory","StorageFactory","$translate",function(t,e,a,o,n,r,s,i){function c(){return r.HttpPost("/getTxFee",{}).then(function(t){return t.data}).catch(function(t){return new Error(500)})}function l(){return r.HttpPost("/getUser",{token:s.get("token")}).then(function(t){return t.data}).catch(function(t){return new Error(500)})}!function(e){t.trx={hash:e.hash,fee:null,payByCredit:!0,upload:!1,desc:""},t.user={credit:0},t.data=e,Promise.all([c(),l()]).then(function(e){t.trx.fee=e[0],t.user.credit=e[1].credit}).catch(function(t){console.error("An error occurred!")})}(a),t.submit=function(){t.msg={},e.$broadcast("createTransactionLoading",!0),n.hide("cancel");var c={token:s.get("token"),hash:a.hash,desc:t.trx.desc};t.trx.upload&&(c.uploadedFile=a.file),r.HttpPostWithFile("/createTnx",c).then(function(a){e.$broadcast("createTransactionLoading",!1),t.msg.status=a.status,200===a.status?(t.msg.type="ok",t.success(a.data)):208===a.status?(t.txId=a.data.txId,o.show({hideDelay:6e4,position:"top right",controller:"ErrorToastController",templateUrl:"/resources/app/transaction/duplicatedDoc.html",locals:{msg:{txId:t.txId}}})):(t.msg.type="error",r.Toast({text:i.instant("transaction.create."+a.status),type:t.msg.type}))}).catch(function(a){e.$broadcast("createTransactionLoading",!1),t.msg.status=a.status,t.msg.type="error",208===a.status?o.show({hideDelay:3e3,position:"top right",templateUrl:"/resources/app/transaction/duplicatedDoc.html"}):r.Toast({text:i.instant("transaction.create."+a.status),type:t.msg.type})})},t.cancel=function(){n.hide("cancel")},t.success=function(t){a.isTrxMine=!0,a.txId=t.txId,n.show({locals:{data:a},controller:"TransactionSummaryController",templateUrl:"/resources/app/transaction/transactionSummary.html",parent:angular.element(document.body),clickOutsideToClose:!0})}}]),angular.module("myApp").controller("TransactionSummaryController",["$scope","data","$mdDialog","UtilsFactory","StorageFactory",function(t,e,a,o,n){function r(e,a){o.HttpPost(e,a).then(function(e){var a=moment(new Date),o=moment(new Date(e.data.txCreatedDate)),n=moment.duration(a.diff(o)),r=parseInt(n.asMinutes());t.trx={hash:e.data.dataHash,created:moment.unix(e.data.txCreatedDate/1e3).format("HH:mm - jYYYY/jMM/jDD"),fileId:e.data.fileId,confirmations:e.data.confirmations,txId:e.data.txId,desc:e.data.desc,duration:{days:parseInt(n.days()),hours:parseInt(n.hours()),minutes:parseInt(n.minutes()),seconds:parseInt(n.seconds())},minutesAgo:r,minutesToConfirmFrom:10-r,minutesToConfirmTo:20-r}}).catch(function(t){})}!function(e){if(!e.dataComplete){var a,o={txId:e.txId};return e.isTrxMine?(a="findUserTnxByTxId",o.token=n.get("token")):a="findTnxByTxId",r(a,o)}var s=moment(new Date),i=moment(new Date(e.txCreatedDate)),c=moment.duration(s.diff(i)),l=parseInt(c.asMinutes());t.trx={hash:e.dataHash,created:moment.unix(e.txCreatedDate/1e3).format("HH:mm - jYYYY/jMM/jDD"),fileId:e.fileId,confirmations:e.confirmations,txId:e.txId,desc:e.desc,minutesAgo:l,minutesToConfirmFrom:10-l,minutesToConfirmTo:20-l}}(e),t.cancel=function(){a.hide("cancel")}}]),myApp.controller("TransactionDetailController",["$scope","$routeParams","UtilsFactory","StorageFactory","_","$translate",function(t,e,a,o,n,r){function s(){t.trx={},t.token=o.get("token"),t.userId=o.get("userId");var n,r={txId:e.id};return t.token?(n="findUserTnxByTxId",r.token=t.token):n="findTnxByTxId",t.loading=!0,a.HttpPost(n,r).then(function(e){if(t.loading=!1,e.data){var a=moment(new Date),o=moment(new Date(e.data.txCreatedDate)),n=moment.duration(a.diff(o)),r=parseInt(n.asMinutes());t.trx={hash:e.data.dataHash,created:moment.unix(e.data.txCreatedDate/1e3).format("HH:mm - jYYYY/jMM/jDD"),fileId:e.data.fileId,confirmations:e.data.confirmations,txId:e.data.txId,desc:e.data.desc,duration:{days:parseInt(n.days()),hours:parseInt(n.hours()),minutes:parseInt(n.minutes()),seconds:parseInt(n.seconds())},minutesAgo:r,minutesToConfirmFrom:10-r,minutesToConfirmTo:20-r,downloadable:e.data.userId==t.userId}}else t.trx=void 0}).catch(function(e){t.loading=!1,t.trx=void 0})}function i(t){for(var e="",a=new Uint8Array(t),o=a.byteLength,n=0;n<o;n++)e+=String.fromCharCode(a[n]);return window.btoa(e)}setTimeout(function(){s()}),t.downloadFile=function(t){var e=o.get("token");return a.HttpGet("/downloadTnxFile/"+e+"&"+t,{}).then(function(t){var e;return t.data&&(e=i(t.data)),e}).catch(function(t){console.error(t)})}}]),angular.module("myApp").controller("AuthController",["$scope","$mdDialog","UtilsFactory","StorageFactory","$translate",function(t,e,a,o){t.signupDone=!1,t.msg={},t.loading=!1,t.userData={email:"",password:"",confirmPassword:""},t.signup=function(){if(t.msg={},t.userData.password!==t.userData.confirmPassword)return t.msg.text="Passwords does not match.",void(t.msg.type="error");t.loading=!0;var o=a.SHA256(t.userData.password),n=a.SHA256(t.userData.confirmPassword);a.HttpPost("/signup",{email:t.userData.email,passwordHash:o,confirmPasswordHash:n,platform:"WEB"}).then(function(a){return t.loading=!1,200===a.status?(t.userData={},e.hide("cancel"),t.signupSuccess()):226===a.status?(t.msg.text="This email is in use. Please enter another email.",t.msg.type="error"):400===a.status&&(t.msg.text="Bad data input. Check and submit again.",t.msg.type="error"),$translate("TITLE")}).then(function(e){t.msg.text=e}).catch(function(e){t.loading=!1,t.msg.text="Something is not working properly. Please try again later."})},t.signin=function(){t.msg={},t.loading=!0;var n=a.SHA256(t.userData.password);a.HttpPost("/login",{email:t.userData.email,passwordHash:n,platform:"WEB"}).then(function(a){t.loading=!1,200===a.status&&(t.userData={},o.set("userId",a.data.userId),o.set("token",a.data.token),o.set("isLogin",!0),o.set("passHash",n),o.set("fname",a.data.name),o.set("lname",a.data.lastName),o.set("pic",a.data.profilePicAddress),e.hide("cancel"))}).then(function(t){console.log(t)}).catch(function(e){t.loading=!1,204===e.status||401===e.status?(t.msg.text="Incorrect username or password. Please review your credentials.",t.msg.type="error"):400===e.status&&(t.msg.text="Bad data input. Check and submit again.",t.msg.type="error")})},t.cancel=function(){e.hide("cancel")},t.signupSuccess=function(){e.show(e.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title("Signup Successful").textContent("You can sign in into your account.").ariaLabel("Signup Success").ok("Ok!"))}}]),angular.module("myApp").controller("ForgetPasswordController",["$scope","$mdDialog","UtilsFactory",function(t,e,a){t.msg={},t.loading=!1,t.userData={email:""},t.submit=function(){t.msg={},t.loading=!0,a.HttpPost("/forgotPassword",{email:t.userData.email}).then(function(a){t.loading=!1,200===a.status?(t.userData={},e.hide("cancel")):(t.msg.status=a.status,t.msg.type="error")}).catch(function(e){t.loading=!1,t.msg.status=e.status,t.msg.type="error"})},t.cancel=function(){e.hide("cancel")}}]),angular.module("myApp").controller("ErrorToastController",["$scope","msg","$mdToast","$location","UtilsFactory","StorageFactory","UserFactory",function(t,e,a,o,n,r,s){t.msg=e,t.closeToast=function(){isDlgOpen||a.hide().then(function(){isDlgOpen=!1})},t.goToTnxDetail=function(){o.path("/transaction/detail/"+t.msg.txId)}}]);